<div class="max-w-3xl mx-auto py-8">
  <%= render "deploy_assist/shared/header" %>
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Stripe Payment Setup</h1>
    <p class="text-gray-600">Step 4 of 4: Review & Confirm</p>

    <!-- Progress bar -->
    <div class="mt-4 w-full bg-gray-200 rounded-full h-2">
      <div class="bg-blue-600 h-2 rounded-full" style="width: 100%"></div>
    </div>
  </div>

  <%= form_with url: deploy_assist.wizards_stripe_step_path(config_id: @service_configuration.id, step_number: 4),
                method: :patch,
                local: true do |f| %>

    <!-- Business Details Review -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-gray-900">Business Information</h2>
        <%= link_to "Edit",
            deploy_assist.wizards_stripe_step_path(config_id: @service_configuration.id, step_number: 1),
            class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
      </div>

      <dl class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <div>
          <dt class="font-medium text-gray-500">Legal Business Name</dt>
          <dd class="mt-1 text-gray-900"><%= @service_configuration.collected_data['legal_business_name'] %></dd>
        </div>
        <div>
          <dt class="font-medium text-gray-500">Country</dt>
          <dd class="mt-1 text-gray-900"><%= @service_configuration.collected_data['country'] %></dd>
        </div>
        <div>
          <dt class="font-medium text-gray-500">Business Type</dt>
          <dd class="mt-1 text-gray-900"><%= @service_configuration.collected_data['business_type']&.titleize %></dd>
        </div>
        <div>
          <dt class="font-medium text-gray-500">Website</dt>
          <dd class="mt-1 text-gray-900"><%= @service_configuration.collected_data['business_url'] %></dd>
        </div>
        <div>
          <dt class="font-medium text-gray-500">Support Email</dt>
          <dd class="mt-1 text-gray-900"><%= @service_configuration.collected_data['support_email'] %></dd>
        </div>
        <% if @service_configuration.collected_data['support_phone'].present? %>
          <div>
            <dt class="font-medium text-gray-500">Support Phone</dt>
            <dd class="mt-1 text-gray-900"><%= @service_configuration.collected_data['support_phone'] %></dd>
          </div>
        <% end %>
      </dl>
    </div>

    <!-- Product Configuration Review -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-gray-900">Product Configuration</h2>
        <%= link_to "Edit",
            deploy_assist.wizards_stripe_step_path(config_id: @service_configuration.id, step_number: 2),
            class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
      </div>

      <dl class="space-y-4 text-sm">
        <div>
          <dt class="font-medium text-gray-500 mb-2">Products to Create</dt>
          <dd class="mt-1">
            <ul class="list-disc list-inside space-y-1 text-gray-900">
              <% (@service_configuration.collected_data['product_names'] || '').split("\n").reject(&:blank?).each do |product| %>
                <li><%= product.strip %></li>
              <% end %>
            </ul>
          </dd>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <dt class="font-medium text-gray-500">Pricing Model</dt>
            <dd class="mt-1 text-gray-900"><%= @service_configuration.collected_data['price_type']&.titleize %></dd>
          </div>
          <div>
            <dt class="font-medium text-gray-500">Currency</dt>
            <dd class="mt-1 text-gray-900"><%= @service_configuration.collected_data['currency']&.upcase %></dd>
          </div>
        </div>
        <div>
          <dt class="font-medium text-gray-500">Subscription Features</dt>
          <dd class="mt-1 text-gray-900">
            <%= @service_configuration.collected_data['enable_subscriptions'] != false ? '‚úÖ Enabled' : '‚ùå Disabled' %>
          </dd>
        </div>
      </dl>
    </div>

    <!-- Webhook Configuration Review -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-gray-900">Webhook Configuration</h2>
        <%= link_to "Edit",
            deploy_assist.wizards_stripe_step_path(config_id: @service_configuration.id, step_number: 3),
            class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
      </div>

      <dl class="space-y-4 text-sm">
        <div>
          <dt class="font-medium text-gray-500">Webhook URL</dt>
          <dd class="mt-1 text-gray-900 font-mono text-xs bg-gray-50 p-2 rounded">
            <%= @service_configuration.collected_data['webhook_url'] %>
          </dd>
        </div>
        <div>
          <dt class="font-medium text-gray-500 mb-2">Monitored Events</dt>
          <dd class="mt-1">
            <div class="flex flex-wrap gap-2">
              <% (@service_configuration.collected_data['events'] || []).each do |event| %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  <%= event %>
                </span>
              <% end %>
            </div>
          </dd>
        </div>
      </dl>
    </div>

    <!-- Next Steps Info -->
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 mb-6">
      <h3 class="text-lg font-semibold text-blue-900 mb-3">üéâ What Happens Next?</h3>
      <ol class="space-y-3 text-sm text-blue-800">
        <li class="flex items-start">
          <span class="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">1</span>
          <span><strong>Setup Guide Generated:</strong> You'll receive step-by-step instructions to create your Stripe account and configure payment processing</span>
        </li>
        <li class="flex items-start">
          <span class="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">2</span>
          <span><strong>Create Stripe Account:</strong> Follow the guide to create your Stripe account and complete business verification</span>
        </li>
        <li class="flex items-start">
          <span class="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">3</span>
          <span><strong>Configure Products:</strong> Use the provided instructions to create products and set pricing</span>
        </li>
        <li class="flex items-start">
          <span class="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">4</span>
          <span><strong>Setup Webhooks:</strong> Get ready-to-use webhook handler code to integrate with your Rails app</span>
        </li>
        <li class="flex items-start">
          <span class="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">5</span>
          <span><strong>Go Live:</strong> Move from test mode to production and start accepting real payments</span>
        </li>
      </ol>
    </div>

    <!-- Confirmation Checkbox -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
      <div class="flex items-start">
        <%= f.check_box :confirm,
            class: "mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",
            required: true %>
        <div class="ml-3">
          <%= f.label :confirm, class: "text-sm font-medium text-gray-700" do %>
            I confirm that the information above is correct and I'm ready to proceed with Stripe setup
          <% end %>
          <p class="mt-1 text-xs text-gray-500">
            You can always come back and modify this configuration later
          </p>
        </div>
      </div>
    </div>

    <!-- Important Notes -->
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-yellow-800">Before Going Live</h3>
          <div class="mt-2 text-sm text-yellow-700">
            <ul class="list-disc list-inside space-y-1">
              <li>Stripe accounts require business verification (can take 1-2 days)</li>
              <li>Test all payment flows in test mode first</li>
              <li>Ensure webhook endpoint is accessible from the internet</li>
              <li>Review Stripe's fees and pricing for your country</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="flex justify-between items-center">
      <%= link_to "Cancel", deploy_assist.root_path, class: "text-gray-600 hover:text-gray-900 font-medium" %>
      <div class="flex gap-3">
        <%= link_to deploy_assist.wizards_stripe_step_path(config_id: @service_configuration.id, step_number: 3), class: "px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors" do %>
          ‚Üê Previous
        <% end %>
        <%= button_tag type: "submit", class: "px-6 py-2 bg-[var(--color-accent-500)] hover:bg-[var(--color-accent-600)] text-white font-medium rounded-lg transition-colors" do %>
          Complete Setup
        <% end %>
      </div>
    </div>

  <% end %>
</div>
